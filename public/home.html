<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>飛騰家電 - 首頁</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="navbar">
    <div class="nav-left">
      <img src="logo1.png" alt="飛騰家電logo" class="logo" />
      <span class="username"></span>
    </div>
  </div>

  <div class="page-title">會員功能首頁</div>

  <div class="menu-card-container">
      <a href="query.html" class="big-card query">報修查詢</a>
      <a href="repair.html" class="big-card repair">報修</a>
      <a href="history.html" class="big-card repair">購買歷史</a>
      <a href="info.html" class="big-card repair">會員資料</a>
  </div>
  <script>
      document.addEventListener("DOMContentLoaded", function () {
        const accountName = localStorage.getItem("userName");
        const displayName = localStorage.getItem("displayName"); // 上次查到的會員名字
      
        const usernameEl = document.querySelector('.username');
      
        if (!accountName) {
          usernameEl.textContent = "歡迎，訪客";
          usernameEl.style.visibility = "visible";
          return;
        }
      
        // 如果有上次的名字，先顯示，加速初始載入
        if (displayName) {
          usernameEl.textContent = `歡迎，${displayName}`;
          usernameEl.style.visibility = "visible";
        }
      
        // 同步再查一次（可選，看是否允許即時同步）
        fetch('/api/proxy-query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ Account_Name: accountName })
        })
          .then(res => res.json())
          .then(data => {
            if (data.Result === 0 && data.Name) {
              localStorage.setItem("displayName", data.Name); // 存起來
              usernameEl.textContent = `歡迎，${data.Name}`;
            } else {
              usernameEl.textContent = "歡迎，會員";
            }
            usernameEl.style.visibility = "visible";
          })
          .catch(err => {
            console.error("查詢會員錯誤：", err);
            usernameEl.textContent = "歡迎，會員";
            usernameEl.style.visibility = "visible";
          });
      });
  </script>
</body>
</html>
